<!DOCTYPE html>
<html lang="en" class="scroll-smooth">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>VPKBiET Confessions üí≠</title>

    <!-- ‚úÖ Tailwind Config with Dark Mode -->
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { inter: ['Inter', 'sans-serif'] },
                    colors: {
                        softblue: '#e0f2fe',
                        softdark: '#1e293b'
                    }
                },
            },
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(to bottom right, #e0f2fe, #f8fafc);
            transition: background 0.4s ease, color 0.4s ease;
        }

        html.dark body {
            background: linear-gradient(to bottom right, #0f172a, #1e293b);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-fadeIn {
            animation: fadeIn 0.4s ease-out;
        }
    </style>
</head>

<body class="min-h-screen text-gray-800 dark:text-gray-100 transition-colors duration-300">

    <!-- üåô Header -->
    <header class="py-8 text-center relative">
        <button id="dark-toggle"
            class="absolute top-6 right-6 p-3 bg-gray-200 dark:bg-gray-700 rounded-full shadow hover:scale-110 transition text-lg">
            üåô
        </button>
        <h1 class="text-5xl font-extrabold text-blue-700 dark:text-blue-400 mb-3 tracking-tight">
            VPKBiET Confessions
        </h1>
        <p class="text-lg text-gray-600 dark:text-gray-300">
            Share your thoughts anonymously üí¨
        </p>
    </header>

    <!-- üìù Confession Input -->
    <main class="max-w-3xl mx-auto px-4 sm:px-6 mb-16">
        <section
            class="bg-white/90 dark:bg-gray-800/80 backdrop-blur-md p-6 rounded-2xl shadow-xl border border-gray-200 dark:border-gray-700 mb-10">
            <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-100">Post a New Confession</h2>
            <textarea id="confession-input"
                class="w-full p-4 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 min-h-[120px] resize-none dark:bg-gray-900 dark:text-gray-100"
                placeholder="Type your confession here..."></textarea>
            <p id="char-count" class="text-gray-400 text-sm text-right mt-2">0 / 300</p>
            <button id="submit-btn"
                class="w-full mt-4 px-6 py-3 bg-blue-600 text-white font-semibold rounded-xl hover:bg-blue-700 active:scale-95 transition">
                Submit Confession
            </button>
            <p id="error" class="text-red-500 text-sm mt-2 hidden"></p>
        </section>

        <!-- üìú Confession List -->
        <section>
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-3xl font-bold pb-2 
               border-b-4 border-blue-500 text-gray-800 
               dark:text-blue-300 dark:border-blue-400">
                    Latest Confessions
                </h2>
            </div>
            <div id="confession-list" class="space-y-4"></div>
        </section>

    </main>

    <!-- ‚úÖ Toast -->
    <div id="toast"
        class="fixed bottom-6 right-6 bg-green-600 text-white px-5 py-3 rounded-lg shadow-lg hidden transition transform">
        Confession submitted ‚úÖ
    </div>

    <!-- üî• Firebase + App Logic -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-app.js";
        import {
            getFirestore,
            collection,
            addDoc,
            query,
            orderBy,
            onSnapshot,
            updateDoc,
            doc,
            increment
        } from "https://www.gstatic.com/firebasejs/10.13.0/firebase-firestore.js";

        // ‚öôÔ∏è Replace this config with your Firebase project info
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT.appspot.com",
            messagingSenderId: "YOUR_SENDER_ID",
            appId: "YOUR_APP_ID"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        // üîó Elements
        const input = document.getElementById('confession-input');
        const button = document.getElementById('submit-btn');
        const list = document.getElementById('confession-list');
        const error = document.getElementById('error');
        const charCount = document.getElementById('char-count');
        const toast = document.getElementById('toast');
        const darkToggle = document.getElementById('dark-toggle');

        // üåô Dark Mode ‚Äî remembers state
        if (localStorage.theme === 'dark' ||
            (!('theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
            darkToggle.textContent = '‚òÄÔ∏è';
        } else {
            document.documentElement.classList.remove('dark');
            darkToggle.textContent = 'üåô';
        }

        darkToggle.addEventListener('click', () => {
            const isDark = document.documentElement.classList.toggle('dark');
            localStorage.theme = isDark ? 'dark' : 'light';
            darkToggle.textContent = isDark ? '‚òÄÔ∏è' : 'üåô';
        });

        // üßÆ Character Counter
        input.addEventListener('input', () => {
            const count = input.value.length;
            charCount.textContent = `${count} / 300`;
            button.disabled = count > 300;
            charCount.classList.toggle('text-red-500', count > 300);
        });

        // üíæ Save Confession
        async function saveConfession() {
            const text = input.value.trim();
            if (!text) {
                error.textContent = "Confession cannot be empty.";
                error.classList.remove('hidden');
                return;
            }
            error.classList.add('hidden');
            button.disabled = true;
            button.textContent = "Submitting...";

            try {
                await addDoc(collection(db, "confessions"), {
                    content: text,
                    timestamp: new Date(),
                    likes: 0
                });
                input.value = "";
                charCount.textContent = "0 / 300";
                showToast();
            } catch (e) {
                error.textContent = "Failed to save confession.";
                error.classList.remove('hidden');
            } finally {
                button.disabled = false;
                button.textContent = "Submit Confession";
            }
        }

        // ‚ù§Ô∏è Like
        async function likeConfession(id) {
            const ref = doc(db, "confessions", id);
            await updateDoc(ref, { likes: increment(1) });
        }

        // üí¨ Reply
        async function addReply(confessionId, text) {
            if (!text.trim()) return;
            await addDoc(collection(db, `confessions/${confessionId}/replies`), {
                text,
                timestamp: new Date()
            });
        }

        // üß± Render Confessions
        function renderConfessions(confessions) {
            if (!confessions.length) {
                list.innerHTML = `<p class='text-center text-gray-500 p-8'>No confessions yet!</p>`;
                return;
            }

            list.innerHTML = confessions.map(c => `
        <div class="confession-card p-5 rounded-2xl border border-gray-200 dark:border-gray-700 shadow-sm bg-white dark:bg-gray-800 animate-fadeIn">
          <p class="text-lg mb-3 whitespace-pre-wrap leading-relaxed">${c.content}</p>
          <div class="flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 border-t pt-2">
            <span>${new Date(c.timestamp?.seconds * 1000 || c.timestamp).toLocaleString()}</span>
            <button class="like-btn text-sm hover:text-red-500 transition" data-id="${c.id}">
              ‚ù§Ô∏è ${c.likes}
            </button>
          </div>
          <div class="mt-3 border-t border-gray-200 dark:border-gray-700 pt-2">
            <div class="replies space-y-2 text-sm mb-2" id="replies-${c.id}"></div>
            <div class="flex gap-2">
              <input type="text" id="reply-input-${c.id}" placeholder="Write a reply..."
                class="flex-1 p-2 border border-gray-300 dark:border-gray-600 rounded-lg dark:bg-gray-900 dark:text-gray-100 text-sm">
              <button data-id="${c.id}" class="reply-btn bg-blue-500 hover:bg-blue-600 text-white px-3 rounded-lg text-sm">Reply</button>
            </div>
          </div>
        </div>
      `).join('');

            document.querySelectorAll('.like-btn').forEach(btn => {
                btn.addEventListener('click', () => likeConfession(btn.dataset.id));
            });

            document.querySelectorAll('.reply-btn').forEach(btn => {
                const confessionId = btn.dataset.id;
                const inputField = document.getElementById(`reply-input-${confessionId}`);
                const container = document.getElementById(`replies-${confessionId}`);

                // Real-time replies
                const repliesCol = collection(db, `confessions/${confessionId}/replies`);
                const repliesQuery = query(repliesCol, orderBy("timestamp", "asc"));
                onSnapshot(repliesQuery, (snapshot) => {
                    const replies = snapshot.docs.map(d => d.data());
                    container.innerHTML = replies.length
                        ? replies.map(r => `<div class='border-l-2 border-blue-500 pl-3 text-sm text-gray-700 dark:text-gray-300 mb-2'>${r.text}</div>`).join('')
                        : `<p class='text-gray-400 text-sm italic'>No replies yet...</p>`;
                });

                btn.addEventListener('click', () => {
                    addReply(confessionId, inputField.value);
                    inputField.value = '';
                });
            });
        }

        // üß† Real-time Listener for Confessions
        const q = query(collection(db, "confessions"), orderBy("timestamp", "desc"));
        onSnapshot(q, (snapshot) => {
            const confessions = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            renderConfessions(confessions);
        });

        // ‚úÖ Toast
        function showToast() {
            toast.classList.remove('hidden');
            setTimeout(() => toast.classList.add('hidden'), 2000);
        }

        button.addEventListener('click', saveConfession);
    </script>
</body>

</html>